CREATE DATABASE rollcall_db;

USE rollcall_db;

CREATE TABLE O_RollCall (
-> rollno INT PRIMARY KEY,
-> name VARCHAR(50)
-> );

CREATE TABLE N_RollCall (
-> rollno INT PRIMARY KEY,
-> name VARCHAR(50)
-> );

INSERT INTO O_RollCall VALUES (1, 'Alice');

INSERT INTO O_RollCall VALUES (2, 'Bob');

INSERT INTO N_RollCall VALUES (2, 'Bob'); 

INSERT INTO N_RollCall VALUES (3, 'Charlie'); 

INSERT INTO N_RollCall VALUES (4, 'Diana'); 

SELECT * FROM O_RollCall;

SELECT * FROM N_RollCall;

DROP PROCEDURE IF EXISTS mycursor1;

DELIMITER //

CREATE PROCEDURE mycursor1()
-> BEGIN
-> DECLARE done INT DEFAULT 0;
-> DECLARE c_rollno INT;
-> DECLARE c_name CHAR(20);
->
-> DECLARE c_studentN CURSOR FOR
-> SELECT rollno, name
-> FROM O_RollCall
-> WHERE rollno NOT IN (SELECT rollno FROM N_RollCall);
->
-> DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = 1;
->
-> OPEN c_studentN;
-> read_loop: LOOP
-> FETCH c_studentN INTO c_rollno, c_name;
->
-> IF done = 1 THEN
-> LEAVE read_loop;
-> END IF;
->
-> INSERT INTO N_RollCall (rollno, name)
-> VALUES (c_rollno, c_name);
-> END LOOP;
-> CLOSE c_studentN;
-> END;
-> //

DELIMITER ;
CALL mycursor1();

SELECT * FROM N_RollCall;

